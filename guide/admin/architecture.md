# CMS. Архитектура

Куб modules/admin имеет следующую структуру:

```php
assets/
    AdminAsset/ - главный ассет CMS
        css/ - стили
        js/ - js, обеспечивающий весь фронтенд CMS
            lib/ - вспомогательные плагины и библиотеки
            model/ - вспомогательные объекты и классы
            store/ - хранилища vuex
            vue/ - Vue компоненты. Основной UI для CMS
                page/ - компоненты страниц
                ui/ - компоненты ui
        ...
classes/ - классы, обеспечивающие взаимодействие UI и бэкенда
commands/ - консольные команды
controllers/ - контроллеры, необходимые для самой CMS
views/ - представления, необходимые для самой CMS
Cube.php
```

## Цикл CMS

1. Пользователь заходит на страницу /admin, которую обрабатывает **AuthController::actionLogin**.
2. **AuthController::actionLogin** отрисовывает шаблон с лэйаутом, который подключает vue-компонент: **vue-page-login**
3. Пользователь видит страницу логина. После корректного ввода данных и авторизации в бэкенде, **vue-page-login** производит
редирект на /admin, который подхватывает **IndexController::actionApp**
4. **IndexController::actionApp** отрисовывает свой шаблон с лэйаутом и запускает **Vue Application**.
5. Далее в рамках CMS все пути изменяются через hash браузера и контролируются с помощью [Vue Router](https://router.vuejs.org/ru/).

Таким образом, маршруты можно разделить на **Backend Routes** (те, которые обрабатываются Front Controller-ом бэкенда)
и **Vue Routes** - задаются через hash и обрабатывются frontend-ом.

### Маршруты

- **Vue Routes** - отвечают за переходы между страницами в CMS. Регистрация происходит в файле config/routes.php
- **Backend Routes** - выступают в качестве API для обмена информацией с фронтендом.
Регистрация базовых маршрутов находится в классе **modules\admin\classes\VueRoutes**.

Тем не менее, не рекомендуется вносить изменения в эти базовые конфигурации. Каждый куб способен самостоятельно добавить
как бэкенд-, так и фронтенд-маршруты в систему. Это будет рассмотрено в [CMS. Управление сущностями](admin/entity.md).

Пример фронтенд-маршрута:
```php
        ['path' => '/list/:entity', 'component' => 'VuePageEntityList', 'sort' => 900],
```
Данный маршрут означает, что Vue Router обработает url: /admin#/list/news и загрузит vue-компонент VuePageEntityList,
передаст ему параметр entity=news, а компонент в свою очередь обратится в бэкенд за листингом для сущности news
(см бэкенд контроллер **AbstractEntityController**).

## Ключевые Vue-компоненты
### Vue pages

Находятся в директории admin/assets/AdminAsset/js/vue/page:
```
VuePage404.js
VuePageLogin.js
VuePageMain.js
VuePageEntityList.js
VuePageEntityDetail.js
```

из них наиболее интересные - **VuePageEntityList** и **VuePageEntityDetail**, отвечающие за листинг и детальную страницу сущностей.
Эти компоненты имеют достаточный уровень абстракции, чтобы гибко работать с данными и обслуживать листинги и детальные
страницы всех типовых сущностей.

В случае, если требуется кастомизация листинга или детальной страницы сущности, то на основе одного из этих компонентов
в ассетах куба создается собственный компонент (копируется + переименовывается) и производится необходимая модификация.

Помимо компонентов страниц, имеются другие vue-компоненты, наиболее интересные из которых - cells и fields.

### Vue cells

Находятся в директории admin/assets/AdminAsset/js/vue/ui с префиксом VueCell.
Отвечают за отрисовку значений в листингах и таблицах.

### Vue fields

Находятся в директории admin/assets/AdminAsset/js/vue/ui с префиксом VueField.
Отвечают за отрисовку редактируемых полей.

**Vue cells и vue fields коррелируют с соответствующими бэкенд-классами с префиксами Cell и Field,
которые задаются (например) в конфигурации сущности**, таким образом бэкенд и фронтенд
умеют согласованно отрисовывать и обрабатывать поля. Об этом в следующем разделе.

Далее: [CMS. Управление сущностями](entity.md)<br>
Вверх: [Оглавление](../index.md)
